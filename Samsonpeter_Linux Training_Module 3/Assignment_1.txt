#!/bin/bash

SOURCE_DIR=$1
BACKUP_DIR=$2
EXTENSION=$3

if [ -z "$SOURCE_DIR" ] || [ -z "$BACKUP_DIR" ] || [ -z "$EXTENSION" ]; then
    echo "Usage: $0 <source_directory> <backup_directory> <file_extension>"
    exit 1
fi

if [ ! -d "$SOURCE_DIR" ]; then
    echo "Error: Source directory does not exist!"
    exit 1
fi

if [ ! -d "$BACKUP_DIR" ]; then
    mkdir -p "$BACKUP_DIR" || { echo "Error: Failed to create backup directory!"; exit 1; }
fi

files=($(find "$SOURCE_DIR" -type f -name "*$EXTENSION"))

if [ ${#files[@]} -eq 0 ]; then
    echo "No matching files found in $SOURCE_DIR"
    exit 1
fi

for file in "${files[@]}"; do
    filename=$(basename "$file")
    dest_file="$BACKUP_DIR/$filename"

    if [ ! -e "$dest_file" ] || [ "$file" -nt "$dest_file" ]; then
        cp "$file" "$dest_file"
    fi
done

du -sh "$BACKUP_DIR" > "$BACKUP_DIR/backup_report.log"
echo "Total files backed up: ${#files[@]}" >> "$BACKUP_DIR/backup_report.log"
echo "Backup stored at: $BACKUP_DIR" >> "$BACKUP_DIR/backup_report.log"

echo "Backup completed! Report saved at $BACKUP_DIR/backup_report.log"
